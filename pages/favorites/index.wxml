<view class="page">
  <view class="page-bg-wrapper">
    <image class="page-bg" src="/data/background.jpg" mode="widthFix" wx:for="{{[1,2,3,4,5]}}" wx:key="index" style="display: block;" />
  </view>
  <view class="page-content">
    <view class="header">
    <view class="header-left">
      <view class="title">è‡£å·³çš„å°å¨æˆ¿</view>
      <view class="subtitle">æŠŠå–œæ¬¢çš„èœç•™åœ¨è¿™é‡Œï¼Œéšæ—¶å¤åš</view>
    </view>
    <view class="header-right">
      <view class="filter-btn" bindtap="openFilter">
        <text class="filter-icon">ç­›é€‰</text>
        <view wx:if="{{selectedIngredients.length > 0}}" class="filter-badge">{{selectedIngredients.length}}</view>
      </view>
      <image 
        class="delete-icon-header" 
        src="{{isDeleteMode ? '/data/components/delete.png' : '/data/components/preDelete.png'}}"
        bindtap="toggleDeleteMode"
        mode="aspectFit"
      />
    </view>
  </view>

  <view wx:if="{{favorites.length===0}}" class="empty">
    <view class="icon">ğŸ¤²</view>
    <view class="text">è¿˜æ²¡æœ‰æ”¶è—ï¼Œå»ä¸»é¡µæŒ‘ä¸€é“å§</view>
  </view>

  <view wx:else class="fav-list">
    <view
      class="fav-item"
      wx:for="{{favorites}}"
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="openRecipe"
    >
      <image class="fav-cover" src="{{item.image}}" mode="aspectFill" />
      <view wx:if="{{isDeleteMode}}" class="delete-mark" data-id="{{item.id}}" catchtap="removeFavorite">âœ•</view>
      <view class="fav-body">
        <view class="fav-title">{{item.title}}</view>
        <view class="fav-ingredients">
          <text class="ingredient-label">éœ€è¦å‡†å¤‡ï¼š</text>
          <view class="ingredient-list">
            <text class="ingredient-item" wx:for="{{item.ingredients}}" wx:key="*this" wx:for-item="ing">{{ing}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  </view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view wx:if="{{showFilter}}" class="filter-modal">
  <view class="filter-mask" catchtouchmove="noop" bindtap="closeFilter"></view>
  <view class="filter-panel" catchtouchmove="noop">
    <view class="filter-header">
      <view class="filter-title">ç­›é€‰é£Ÿæ</view>
      <view class="filter-close" bindtap="closeFilter">âœ•</view>
    </view>
    
    <scroll-view class="filter-content" scroll-y>
      <!-- å·²é€‰æ ï¼šé€‰ä¸­çš„é£Ÿæä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œç‚¹å‡»å¯å–æ¶ˆ -->
      <view class="selected-bar" wx:if="{{selectedIngredients.length > 0}}">
        <view class="selected-bar-title">å·²é€‰</view>
        <scroll-view class="selected-bar-list" scroll-x>
          <view
            class="selected-pill"
            wx:for="{{selectedIngredients}}"
            wx:key="*this"
            data-ingredient="{{item}}"
            bindtap="toggleIngredientByName"
          >
            {{item}}
            <text class="selected-pill-x">Ã—</text>
          </view>
        </scroll-view>
      </view>

      <view class="filter-categories">
        <view 
          wx:for="{{filterCategories}}" 
          wx:key="name" 
          wx:for-item="category"
          class="filter-category"
        >
          <view 
            class="category-header"
            data-index="{{index}}"
            bindtap="toggleCategory"
          >
            <text class="category-name">{{category.name}}</text>
            <text class="category-arrow">{{category.active ? 'â–¼' : 'â–¶'}}</text>
          </view>
          
          <view wx:if="{{category.active}}" class="category-items">
            <view
              wx:for="{{category.items}}"
              wx:key="*this"
              wx:for-item="ingredient"
              class="filter-ingredient-item"
              aria-selected="{{selectedIngredients.indexOf(ingredient) > -1}}"
              data-ingredient="{{ingredient}}"
              bindtap="toggleIngredientByName"
            >
              {{ingredient}}
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="filter-footer">
      <button class="filter-clear" bindtap="clearFilter">æ¸…é™¤</button>
      <button class="filter-confirm" bindtap="confirmFilter">ç¡®å®š</button>
    </view>
  </view>
</view>

